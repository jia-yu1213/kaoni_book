<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Rent-Mapper">

	<select id="selectNowRentCount" resultType="int">
		/* selectNowRentCount 현재 연체가 아니면서 대여중인 책의 갯수*/
		select count(rent_no) 
		from book_rent 
		where id = #{id} 
	     <![CDATA[
		and rent_end>sysdate 
		and real_end is null
		]]>
	</select>
	
	<select id="selectOverdueRentCount" resultType="int">
		/* selectOverdueRentCount 현재 연체중인 책의 갯수*/
		select count(rent_no) from book_rent
        where id=#{id}
        <![CDATA[
        and rent_end<sysdate 
        and real_end is null
		]]>
	</select>
	
	<select id="selectOverdueDate" resultType="str">
		/* selectOverdueDate 연체 기간*/
        <![CDATA[
        select a.overdue from (
        select max(real_end+((real_end)-(rent_end))) overdue from book_rent
        where id=#{id}
        and real_end is not null
        and rent_end<real_end) a
        where overdue>=sysdate
		]]>
	</select>
	
	
	<update id="insertRent" parameterType="rent">
	/* insertRent 대여이력 업데이트*/
		insert into 
		book_rent(rent_no,book_no,id)
		values((select nvl(max(rent_no),0)+1 from book_rent),#{book_no},#{id}) 
	</update>	
	
	<update id="updateReturnBook" parameterType="rent">
	/* updateReturnBook 반납 업데이트*/
		update book_rent set 
		real_end = sysdate
		where rent_no=#{rent_no}
	</update>
</mapper>








